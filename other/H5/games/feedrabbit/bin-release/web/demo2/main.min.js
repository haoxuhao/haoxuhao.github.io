var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Article=function(t){function e(e,i){var o=t.call(this)||this;return o.DefaultTime=1e3,o.type=e,o.size=i,o.createArticle(),o}return __extends(e,t),e.prototype.createArticle=function(){var t=this.createBitmapByName(this.type);t.scaleX=t.scaleY=this.size,this.$setWidth(t.width),this.$setHeight(t.height),this.anchorOffsetX=.5*t.width,this.anchorOffsetY=.5*t.height,this.backTime=this.createBackTime(this.size),this.addChild(t)},e.prototype.isRemoved=function(){},e.prototype.createBackTime=function(t){return this.DefaultTime},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.Sprite);__reflect(Article.prototype,"Article");var Farmer=function(t){function e(e,i,o){var n=t.call(this)||this;return n.imagename=e,n.initialPoint=i,n.farmland=o,n.set(),n}return __extends(e,t),e.prototype.set=function(){this.armature=this.loadDrangonBone(),this.addChild(this.armature),console.log("the width of the farmer is "+this.width)},e.prototype.loadDrangonBone=function(){var t=RES.getRes("Ubbie_ske_json"),e=RES.getRes("Ubbie_tex_json"),i=RES.getRes("Ubbie_tex_png"),o=new dragonBones.EgretFactory;o.addDragonBonesData(dragonBones.DataParser.parseDragonBonesData(t)),o.addTextureAtlas(new dragonBones.EgretTextureAtlas(i,e));var n=o.buildArmatureDisplay("ubbie");return n.scaleX=n.scaleY=.2,n.anchorOffsetX=.2*n.width*.5,n.anchorOffsetY=.2*n.height,n},e.prototype.run=function(){this.armature.animation.play("walk",0)},e.prototype.back=function(t){},e.prototype.dig=function(){this.armature.animation.play("stand",0)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.isHitSomething=function(t){var e=!1;return e?!0:!1},e}(egret.DisplayObjectContainer);__reflect(Farmer.prototype,"Farmer");var Farmland=function(t){function e(){var e=t.call(this)||this;return e.loadBg(),e}return __extends(e,t),e.prototype.loadBg=function(){var t=this.createBitmapByName("farm_jpg");t.width*=1.5,t.height*=2,this.$setWidth(t.width),this.$setHeight(t.height),this.addChild(t)},e.prototype.add=function(t,e){t.anchorOffsetX=.5*t.width,t.anchorOffsetY=.5*t.height,t.x=e.x,t.y=e.y,this.addChild(t)},e.prototype.remove=function(){},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.Sprite);__reflect(Farmland.prototype,"Farmland");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.Step=15,e.TimeSlice=300,e.DefaultBackTime=1e3,e.isRotatintMode=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){var t=this,e=this.createBitmapByName("bg_png");this.addChild(e);var i=this.stage.stageWidth,o=this.stage.stageHeight;e.width=i,e.height=o;var n=new egret.Point(.2*e.width,50);console.log(n.toString()),this.farmland=new Farmland,this.farmland.x=n.x,this.farmland.y=n.y,this.addChild(this.farmland),console.log("the location of the farmland is "+this.farmland.localToGlobal().toString());var r=new Article("carrot_png",1.2),a=new Article("carrot_png",1.5),s=new Article("dandelion_png",1),h=new Article("stone2_png",.3),l=new Article("soil_png",.6);this.farmland.add(r,new egret.Point(30,30)),this.printTheLocation(r),this.farmland.add(a,new egret.Point(0,this.farmland.height)),this.farmland.add(s,new egret.Point(this.farmland.width,0)),this.farmland.add(h,new egret.Point(.5*this.farmland.width,.5*this.farmland.height)),this.farmland.add(l,new egret.Point(this.farmland.width,this.farmland.height)),this.initialPoint=new egret.Point(.809*i,.5*o),this.farmer=new Farmer("farmer_png",this.initialPoint,this.farmland),this.farmer.x=this.initialPoint.x,this.farmer.y=this.initialPoint.y-50,this.farmer.run(),this.addChild(this.farmer),this.pointer=new Pointer,this.pointer.x=this.initialPoint.x-30,this.pointer.y=this.initialPoint.y,this.addChild(this.pointer),this.pointer.run(),console.log("the angle is 195.5 and cos and sin are "+Math.cos(195.5)+" sin is "+Math.sin(195.5)),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){t.angle=(180-t.pointer.angle)/180*Math.PI,console.log("the angle now is "+t.angle),t.pointer.stop(),t.moveFarmer()},this)},e.prototype.printTheLocation=function(t){console.log("( "+t.x+", "+t.y+" )")},e.prototype.moveTo=function(t,e,i){var o=egret.Tween.get(t);return o.to({x:e.x,y:e.y},i),o},e.prototype.moveFarmer=function(){var t=this,e=-1,i=this.getAllTheArticlesAnchor(this.farmland),o=function(){var n=t.farmer.localToGlobal(),r=n.x+t.Step*Math.cos(t.angle),a=n.y-t.Step*Math.sin(t.angle),s=new egret.Point(r,a);console.log("the location now is "+n.toString()),console.log("the next point is "+s.toString()),console.log("the angle is "+t.angle);var h=t.moveTo(t.farmer,s,t.TimeSlice);t.isHitSomething(t.farmer,i,e)?(t.farmer.dig(),t.farmer.run(),t.moveTo(t.farmer,t.initialPoint,t.DefaultBackTime).call(function(){t.pointer.run()})):t.isOutOfFarmland(t.farmer)?(t.farmer.back(t.DefaultBackTime),t.moveTo(t.farmer,t.initialPoint,t.DefaultBackTime).call(function(){t.pointer.run()})):h.call(o)},n=this.farmer.localToGlobal(),r=n.x+this.Step*Math.cos(this.angle),a=n.y-this.Step*Math.sin(this.angle),s=new egret.Point(r,a);console.log("the location now is "+n.toString()),console.log("the next point is "+s.toString()),console.log("the angle is "+this.angle);this.moveTo(this.farmer,s,this.TimeSlice).call(o)},e.prototype.backToInitialPoint=function(t,e){},e.prototype.getAllTheArticlesAnchor=function(t){for(var e=t.$children,i=[],o=0;o<e.length;o++)i[o]=e[o].localToGlobal();return i},e.prototype.isOutOfFarmland=function(t){var e=(this.farmland.width,this.farmland.height),i=this.farmland.localToGlobal(),o=t.localToGlobal(),n=i.x+.2*t.width,r=i.y+.5*t.height,a=i.y+e-.05*t.height;return console.log("the width of farmer is "+t.width),console.log("the height of farmer is "+t.height),console.log("the lefEdge is "+n),console.log("the upEdge is "+r),console.log("the downEdge is "+a),console.log("the anchor of the farmer is "+o.toString()),o.x<n?!0:o.y<r?!0:o.y>a?!0:!1},e.prototype.isHitSomething=function(t,e,i){for(var o=!1,n=0;n<e.length;n++)if(t.hitTestPoint(e[n].x,e[n].y)){o=!0,i=n;break}return o?o:(i=-1,!1)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.setLocation=function(t,e,i){},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Pointer=function(t){function e(){var e=t.call(this)||this;return e.mode=0,e.direction=0,e.createPointer(),e}return __extends(e,t),e.prototype.createPointer=function(){this.pointer=this.createBitmapByName("arrow_png");var t=this.createBitmapByName("round_png");t.anchorOffsetX=0,t.anchorOffsetY=.5*t.height,this.anchorOffsetX=.5*this.pointer.width,this.anchorOffsetY=.5*t.height,this.pointer.anchorOffsetX=this.pointer.width,this.pointer.anchorOffsetY=.5*this.pointer.height,t.x=0-this.pointer.width-10,this.addChild(this.pointer),this.addChild(t),this.$setWidth(this.pointer.width),this.$setHeight(t.height),this.addEventListener(egret.Event.ENTER_FRAME,this.changeRotation,this)},e.prototype.run=function(){this.mode=0},e.prototype.changeRotation=function(t){return 0==this.mode?(70==this.pointer.rotation?(this.pointer.rotation-=e.STEP_ROT,this.direction=0):-70==this.pointer.rotation?(this.pointer.rotation+=e.STEP_ROT,this.direction=1):this.direction?this.pointer.rotation+=e.STEP_ROT:this.pointer.rotation-=e.STEP_ROT,this.angle=this.pointer.rotation,!1):(this.angle=this.pointer.rotation,console.log("the pointer rotation now is "+this.angle),!1)},e.prototype.stop=function(){this.mode=1},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.DisplayObjectContainer);Pointer.STEP_ROT=.5,__reflect(Pointer.prototype,"Pointer");