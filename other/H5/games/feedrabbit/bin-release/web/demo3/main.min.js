var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},Article=function(t){function e(e,n){var i=t.call(this)||this;return i.DefaultTime=1e3,i.type=e,i.size=n,i.createArticle(),i}return __extends(e,t),e.prototype.createArticle=function(){var t=this.createBitmapByName(this.type);t.scaleX=t.scaleY=this.size,this.$setWidth(t.width),this.$setHeight(t.height),this.anchorOffsetX=.5*t.width,this.anchorOffsetY=.5*t.height,this.backTime=this.createBackTime(this.size),this.score=this.calculateScore(),this.addChild(t)},e.prototype.isRemoved=function(){},e.prototype.createBackTime=function(t){return t*this.DefaultTime},e.prototype.calculateScore=function(){return this.getValue()*this.size},e.prototype.getValue=function(){var t;switch(this.type){case"carrot_png":t=10;break;case"dandelion_png":t=20;break;case"cabbage_png":t=15;break;default:t=0}return t},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},e}(egret.Sprite);__reflect(Article.prototype,"Article");var Constants=function(){function t(){this.Article_Round1=[new Article("cabbage_png",t.size_round1[0]),new Article("cabbage_png",t.size_round1[0]),new Article("cabbage_png",t.size_round1[0]),new Article("cabbage_png",t.size_round1[0]),new Article("cabbage_png",t.size_round1[0]),new Article("cabbage_png",t.size_round1[0]),new Article("cabbage_png",t.size_round1[0]),new Article("cabbage_png",t.size_round1[0])],this.Article_Round2=[new Article("carrot_png",t.size_round2[0]),new Article("carrot_png",t.size_round2[0]),new Article("carrot_png",t.size_round2[0]),new Article("carrot_png",t.size_round2[0]),new Article("carrot_png",t.size_round2[0]),new Article("carrot_png",t.size_round2[0]),new Article("carrot_png",t.size_round2[0]),new Article("carrot_png",t.size_round2[0])],this.Article_Round3=[new Article("cabbage_png",t.size_round3[0]),new Article("cabbage_png",t.size_round3[0]),new Article("cabbage_png",t.size_round3[0]),new Article("cabbage_png",t.size_round3[0]),new Article("cabbage_png",t.size_round3[0]),new Article("cabbage_png",t.size_round3[0]),new Article("cabbage_png",t.size_round3[0]),new Article("cabbage_png",t.size_round3[0])],this.Article_Round4=[new Article("cabbage_png",t.size_round4[0]),new Article("cabbage_png",t.size_round4[0]),new Article("cabbage_png",t.size_round4[0]),new Article("cabbage_png",t.size_round4[0]),new Article("cabbage_png",t.size_round4[0]),new Article("cabbage_png",t.size_round4[0]),new Article("cabbage_png",t.size_round4[0]),new Article("cabbage_png",t.size_round4[0])]}return t}();Constants.Locations_Round1=[new egret.Point(50,50),new egret.Point(50,150),new egret.Point(50,250),new egret.Point(50,300),new egret.Point(50,400),new egret.Point(100,50),new egret.Point(100,150),new egret.Point(100,250)],Constants.Locations_Round2=[new egret.Point(50,50),new egret.Point(50,150),new egret.Point(50,250),new egret.Point(50,300),new egret.Point(50,400),new egret.Point(100,50),new egret.Point(100,150),new egret.Point(100,250)],Constants.Locations_Round3=[new egret.Point(50,50),new egret.Point(50,50),new egret.Point(50,50),new egret.Point(50,50),new egret.Point(50,50),new egret.Point(50,50),new egret.Point(50,50),new egret.Point(50,50)],Constants.Locations_Round4=[new egret.Point(50,50),new egret.Point(50,50),new egret.Point(50,50),new egret.Point(50,50),new egret.Point(50,50),new egret.Point(50,50),new egret.Point(50,50),new egret.Point(50,50)],Constants.size_round1=[1,1,1,1],Constants.size_round2=[2,2,2,2],Constants.size_round3=[1,1,1,1],Constants.size_round4=[1,1,1,1],Constants.TargetScore_Round1=20,Constants.TargetScore_Round2=200,Constants.TargetScore_Round3=300,Constants.TargetScore_Round4=400,Constants.Time_Game=30,__reflect(Constants.prototype,"Constants");var Farmer=function(t){function e(e,n,i){var o=t.call(this)||this;return o.imagename=e,o.initialPoint=n,o.farmland=i,o.set(),o}return __extends(e,t),e.prototype.set=function(){this.armature=this.loadDrangonBone(),this.addChild(this.armature),console.log("the width of the farmer is "+this.width)},e.prototype.loadDrangonBone=function(){var t=RES.getRes("Ubbie_ske_json"),e=RES.getRes("Ubbie_tex_json"),n=RES.getRes("Ubbie_tex_png"),i=new dragonBones.EgretFactory;i.addDragonBonesData(dragonBones.DataParser.parseDragonBonesData(t)),i.addTextureAtlas(new dragonBones.EgretTextureAtlas(n,e));var o=i.buildArmatureDisplay("ubbie");return o.scaleX=o.scaleY=.2,o.anchorOffsetX=.2*o.width*.5,o.anchorOffsetY=.2*o.height,o},e.prototype.run=function(){this.armature.animation.play("walk",0)},e.prototype.stand=function(){this.armature.animation.play("stand",0)},e.prototype.back=function(t){},e.prototype.dig=function(){this.armature.animation.play("stand",0)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},e.prototype.isHitSomething=function(t){var e=!1;return e?!0:!1},e}(egret.DisplayObjectContainer);__reflect(Farmer.prototype,"Farmer");var Farmland=function(t){function e(){var e=t.call(this)||this;return e.loadBg(),e}return __extends(e,t),e.prototype.loadBg=function(){var t=this.createBitmapByName("farm_jpg");t.width*=1.5,t.height*=2,this.$setWidth(t.width),this.$setHeight(t.height),this.addChild(t)},e.prototype.add=function(t,e){t.anchorOffsetX=.5*t.width,t.anchorOffsetY=.5*t.height,t.x=e.x,t.y=e.y,this.addChild(t)},e.prototype.remove=function(){},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},e}(egret.Sprite);__reflect(Farmland.prototype,"Farmland");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.Step=15,e.TimeSlice=100,e.DefaultBackTime=1e3,e.sum=0,e.Time_Game=Constants.Time_Game,e.round=1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){var t=this,e=this.createBitmapByName("bg_png");this.addChild(e);var n=this.stage.stageWidth,i=this.stage.stageHeight;e.width=n,e.height=i;var o=new egret.Point(.2*e.width,50);console.log(o.toString()),this.farmland=new Farmland,this.farmland.x=o.x,this.farmland.y=o.y,this.addChild(this.farmland),console.log("the location of the farmland is "+this.farmland.localToGlobal().toString()),this.constants=new Constants;[new Article("carrot_png",1.2),new Article("carrot_png",1.5),new Article("dandelion_png",2),new Article("stone2_png",.3),new Article("soil_png",.6),new Article("cabbage_png",1)],[new egret.Point(30,30),new egret.Point(30,this.farmland.height-30),new egret.Point(this.farmland.width,0),new egret.Point(.5*this.farmland.width,.5*this.farmland.height),new egret.Point(this.farmland.width,this.farmland.height),new egret.Point(200,200)];this.setFarmland(this.constants.Article_Round1,Constants.Locations_Round1),this.initialPoint=new egret.Point(.809*n,.5*i),this.farmer=new Farmer("farmer_png",this.initialPoint,this.farmland),this.farmer.x=this.initialPoint.x,this.farmer.y=this.initialPoint.y,this.farmer.stand(),this.addChild(this.farmer),this.pointer=new Pointer,this.pointer.x=this.initialPoint.x-30,this.pointer.y=this.initialPoint.y,this.addChild(this.pointer),this.pointer.run(),console.log("the angle is 195.5 and cos and sin are "+Math.cos(195.5)+" sin is "+Math.sin(195.5)),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){t.angle=(180-t.pointer.angle)/180*Math.PI,console.log("the angle now is "+t.angle),t.pointer.stop(),t.moveFarmer()},this),this.textField_Sum=new egret.TextField,this.setTextForm(this.textField_Sum,10,10),this.addChild(this.textField_Sum),this.timeShow=new egret.TextField,this.setTextForm(this.timeShow,500,10),this.addChild(this.timeShow),this.roundShow=new egret.TextField,this.setTextForm(this.roundShow,1e3,10),this.addChild(this.roundShow),this.textField_Message=new egret.TextField,this.setTextForm(this.textField_Message,800,600),this.addChild(this.textField_Message),this.showMessage(),this.showScore(),this.showRound(),this.setTimer()},e.prototype.setTextForm=function(t,e,n){t.size=32,t.x=e,t.y=n,t.textAlign=egret.HorizontalAlign.LEFT,t.textColor=16711680,t.type=egret.TextFieldType.DYNAMIC,t.lineSpacing=6,t.multiline=!0},e.prototype.printTheLocation=function(t){console.log("( "+t.x+", "+t.y+" )")},e.prototype.moveTo=function(t,e,n){var i=egret.Tween.get(t);return i.to({x:e.x,y:e.y},n),i},e.prototype.moveFarmer=function(){var t,e=this,n=(this.farmland.$children,this.getAllTheArticlesAnchor(this.farmland));this.farmer.run();var i=function(){var o=e.farmer.localToGlobal(),r=o.x+e.Step*Math.cos(e.angle),s=o.y-e.Step*Math.sin(e.angle),a=new egret.Point(r,s);console.log("the location now is "+o.toString()),console.log("the next point is "+a.toString()),console.log("the angle is "+e.angle);var h=e.moveTo(e.farmer,a,e.TimeSlice);if(t=e.isHitSomething(e.farmer,n),t>0){e.farmer.dig(),console.log("the target's loc is "+t);var c=e.farmland.getChildAt(t),l=c.backTime;e.farmer.run(),e.sum+=c.score,e.farmland.removeChild(c),e.moveTo(e.farmer,e.initialPoint,l).call(function(){e.pointer.run(),e.showScore(),e.farmer.stand()})}else e.isOutOfFarmland(e.farmer)||0==e.Time_Game?(e.farmer.back(e.DefaultBackTime),e.moveTo(e.farmer,e.initialPoint,e.DefaultBackTime).call(function(){e.pointer.run(),e.farmer.stand()})):h.call(i)};i()},e.prototype.backToInitialPoint=function(t,e){},e.prototype.getAllTheArticlesAnchor=function(t){for(var e=t.$children,n=[],i=0;i<e.length;i++)n[i]=e[i].localToGlobal();return n},e.prototype.isOutOfFarmland=function(t){var e=(this.farmland.width,this.farmland.height),n=this.farmland.localToGlobal(),i=t.localToGlobal(),o=n.x+.2*t.width,r=n.y+.2*t.height,s=n.y+e+.2*t.height;return console.log("the width of farmer is "+t.width),console.log("the height of farmer is "+t.height),console.log("the lefEdge is "+o),console.log("the upEdge is "+r),console.log("the downEdge is "+s),console.log("the anchor of the farmer is "+i.toString()),i.x<o?!0:i.y<r?!0:i.y>s?!0:!1},e.prototype.isHitSomething=function(t,e){for(var n=-1,i=0;i<e.length;i++)if(t.hitTestPoint(e[i].x,e[i].y)){n=i;break}return n},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},e.prototype.quit=function(){},e.prototype.update=function(){if(this.isPassed){switch(this.round){case 1:this.setFarmland(this.constants.Article_Round2,Constants.Locations_Round2);break;case 2:this.setFarmland(this.constants.Article_Round3,Constants.Locations_Round3);break;case 3:this.setFarmland(this.constants.Article_Round4,Constants.Locations_Round4);break;case 4:this.setFarmland(this.constants.Article_Round1,Constants.Locations_Round1)}this.round++}else this.round=1,this.sum=0,this.setFarmland(this.constants.Article_Round1,Constants.Locations_Round1)},e.prototype.setFarmland=function(t,e){var n=this.farmland.$children;console.log("the children left is "+n.length),this.farmland.removeChildren();for(var i=0;i<t.length;i++)this.farmland.add(t[i],e[i])},e.prototype.isWin=function(){switch(this.round){case 1:this.sum-=Constants.TargetScore_Round1;break;case 2:this.sum-=Constants.TargetScore_Round2;break;case 3:this.sum-=Constants.TargetScore_Round3;break;case 4:this.sum-=Constants.TargetScore_Round4}return this.sum>=0?!0:!1},e.prototype.showScore=function(){this.textField_Sum.text="Score: "+this.sum},e.prototype.showRound=function(){this.roundShow.text="Round: "+this.round},e.prototype.showMessage=function(){this.textField_Message.text="is win or not ? :"+this.isPassed},e.prototype.showTime=function(){this.Time_Game--,this.timeShow.text="Time: "+this.Time_Game,0==this.Time_Game&&(this.Time_Game=Constants.Time_Game,this.isPassed=this.isWin(),this.showMessage(),this.update(),this.showScore(),this.showRound())},e.prototype.setTimer=function(){this.timer=new egret.Timer(1e3,0),this.timer.addEventListener(egret.TimerEvent.TIMER,this.showTime,this),this.timer.start()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Pointer=function(t){function e(){var e=t.call(this)||this;return e.mode=0,e.direction=0,e.createPointer(),e}return __extends(e,t),e.prototype.createPointer=function(){this.pointer=this.createBitmapByName("arrow_png");var t=this.createBitmapByName("round_png");t.anchorOffsetX=0,t.anchorOffsetY=.5*t.height,this.anchorOffsetX=.5*this.pointer.width,this.anchorOffsetY=.5*t.height,this.pointer.anchorOffsetX=this.pointer.width,this.pointer.anchorOffsetY=.5*this.pointer.height,t.x=0-this.pointer.width-10,this.addChild(this.pointer),this.addChild(t),this.$setWidth(this.pointer.width),this.$setHeight(t.height),this.addEventListener(egret.Event.ENTER_FRAME,this.changeRotation,this)},e.prototype.run=function(){this.mode=0},e.prototype.changeRotation=function(t){return 0==this.mode?(70==this.pointer.rotation?(this.pointer.rotation-=e.STEP_ROT,this.direction=0):-70==this.pointer.rotation?(this.pointer.rotation+=e.STEP_ROT,this.direction=1):this.direction?this.pointer.rotation+=e.STEP_ROT:this.pointer.rotation-=e.STEP_ROT,this.angle=this.pointer.rotation,!1):(this.angle=this.pointer.rotation,console.log("the pointer rotation now is "+this.angle),!1)},e.prototype.stop=function(){this.mode=1},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},e}(egret.DisplayObjectContainer);Pointer.STEP_ROT=.5,__reflect(Pointer.prototype,"Pointer");